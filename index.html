<!DOCTYPE html>
<html>
<head>
  <title>FAQ Schema Generator - Free Tool</title>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .container {
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    h1 {
      color: #667eea;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 5px;
      color: #333;
    }
    input, textarea, select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #667eea;
    }
    .helper-text {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
    button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .success-message {
      display: none;
      background: #d4edda;
      color: #155724;
      padding: 20px;
      border-radius: 6px;
      margin-top: 20px;
    }
    .error-message {
      display: none;
      background: #f8d7da;
      color: #721c24;
      padding: 20px;
      border-radius: 6px;
      margin-top: 20px;
    }
    .loading {
      display: none;
      text-align: center;
      margin-top: 20px;
    }
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ FAQ Schema Generator</h1>
    <p class="subtitle">Generate Google-compliant FAQ schema in seconds. 100% free.</p>
    
    <form id="faqForm">
      <!-- Single URL Mode -->
      <div class="form-group">
        <label for="page_url">Page URL</label>
        <input 
          type="url" 
          id="page_url" 
          name="page_url" 
          
          placeholder="https://example.com/product-page"
        >
        <div class="helper-text">The page where you'll add the FAQ schema</div>
      </div>

      <div class="form-group">
        <label for="seed_keyword">Target Keyword</label>
        <input 
          type="text" 
          id="seed_keyword" 
          name="seed_keyword" 
          
          placeholder="women's running shoes"
        >
        <div class="helper-text">Main keyword for this page</div>
      </div>

      <div class="form-group">
        <label for="client_name">Client/Project Name</label>
        <input 
          type="text" 
          id="client_name" 
          name="client_name"
          placeholder="Acme Shoes"
        >
      </div>

      <div class="form-group">
        <label for="user_email">Your Email *</label>
        <input 
          type="email" 
          id="user_email" 
          name="user_email" 
          required
          placeholder="you@company.com"
        >
        <div class="helper-text">We'll send your results here (+ implementation guide)</div>
      </div>

      <div class="form-group">
        <label for="target_country">Target Country</label>
        <select id="target_country" name="target_country">
          <option value="US">United States</option>
          <option value="UK">United Kingdom</option>
          <option value="CA">Canada</option>
          <option value="AU">Australia</option>
          <option value="DE">Germany</option>
          <option value="FR">France</option>
        </select>
      </div>

      <div class="form-group">
        <label for="pasted_paa_text">Manual PAA Questions (Optional)</label>
        <textarea 
          id="pasted_paa_text" 
          name="pasted_paa_text"
          rows="4"
          placeholder="Paste 'People Also Ask' questions here (one per line or separated by semicolons)"
        ></textarea>
        <div class="helper-text">If you don't have a SerpAPI key, paste Google PAA questions manually</div>
      </div>

      <div class="form-group">
        <label for="desired_faq_count">Number of FAQs</label>
        <input 
          type="number" 
          id="desired_faq_count" 
          name="desired_faq_count"
          value="8"
          min="3"
          max="15"
        >
      </div>
      
      <div class="form-group">
        <label for="csvFile">Or Upload CSV (Batch Mode)</label>
        <input 
          type="file" 
          id="csvFile" 
          accept=".csv"
        >
        <div class="helper-text">
          CSV format: page_url, seed_keyword, client_name, target_country, language
        </div>
      </div>

      <button type="submit" id="submitBtn">
        Generate FAQ Schema (Single URL)
      </button>
      
    </form>

    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <p>Generating your FAQ schema... (30-60 seconds)</p>
    </div>

    <div class="success-message" id="successMessage">
      <h3>‚úÖ Success!</h3>
      <p>Your FAQ schema has been generated and sent to your email.</p>
      <p><strong>Batch ID:</strong> <span id="batchId"></span></p>
      <p><a href="#" id="sheetLink" target="_blank">View Results in Google Sheet ‚Üí</a></p>
    </div>

    <div class="error-message" id="errorMessage">
      <h3>‚ùå Error</h3>
      <p id="errorText"></p>
    </div>
  </div>

  <script>
    const form = document.getElementById('faqForm');
    const submitBtn = document.getElementById('submitBtn');
    const loading = document.getElementById('loading');
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');
    const csvFileInput = document.getElementById('csvFile');

    csvFileInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const userEmail = document.getElementById('user_email').value;
      if (!userEmail) {
        alert('Please enter your email address first. The results will be sent there.');
        csvFileInput.value = ''; // Reset the file input
        return;
      }
      
      form.style.display = 'none';
      loading.style.display = 'block';
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';

      const reader = new FileReader();
      reader.onload = async (event) => {
        const csvData = event.target.result;

        try {
          // IMPORTANT: Make sure this URL is your PRODUCTION URL for the live version
          const response = await fetch('https://n8n.liftflows.com/webhook/faq-forge-batch', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              csv_data: csvData,
              user_email: userEmail,
              project_id: 'batch-' + Date.now()
            })
          });

          const result = await response.json();
          if (!response.ok) {
            throw new Error(result.message || 'The server returned an error.');
          }

          loading.style.display = 'none';
          successMessage.style.display = 'block';
          successMessage.innerHTML = `
            <h3>‚úÖ Batch Processing Started!</h3>
            <p>Your CSV file has been received and is being processed.</p>
            <p>You will receive progress and completion emails at <strong>${userEmail}</strong>.</p>
          `;
          console.log('Batch started:', result.batch_id);

        } catch (error) {
          loading.style.display = 'none';
          errorMessage.style.display = 'block';
          document.getElementById('errorText').textContent = error.message;
          form.style.display = 'block';
        }
      };
      reader.readAsText(file);
    });
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // ==========================================================
      // ===== THIS IS THE NEW CODE THAT FIXES THE CONFLICT =====
      // ==========================================================
      // If the user has selected a file, the 'change' event listener 
      // for the CSV file will handle it. We should not proceed with 
      // the single URL submission.
      if (csvFileInput.files.length > 0) {
        alert('A CSV file is selected. That will be processed automatically. To submit a single URL instead, please remove the file first.');
        return; // Stop the function here
      }
      // ==========================================================
      // ================= END OF NEW CODE ========================
      // ==========================================================


      // Hide previous messages
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';

      // Show loading
      submitBtn.disabled = true;
      loading.style.display = 'block';

      // Collect form data
      const formData = {
        page_url: document.getElementById('page_url').value,
        seed_keyword: document.getElementById('seed_keyword').value,
        client_name: document.getElementById('client_name').value || 'Default Client',
        user_email: document.getElementById('user_email').value,
        target_country: document.getElementById('target_country').value,
        language: 'en',
        pasted_paa_text: document.getElementById('pasted_paa_text').value || null,
        desired_faq_count: parseInt(document.getElementById('desired_faq_count').value),
        premium_mode: false
      };

      try {
        // IMPORTANT: Make sure this URL is your PRODUCTION URL for the live version
        const response = await fetch('https://n8n.liftflows.com/webhook/faq-forge-batch', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (response.ok && result.success) {
          // Show success message
          loading.style.display = 'none';
          successMessage.style.display = 'block';
          document.getElementById('batchId').textContent = result.batch_id;
          document.getElementById('sheetLink').href = result.sheet_link;

          // Reset form
          form.reset();
        } else {
          throw new Error(result.message || 'Unknown error occurred');
        }

      } catch (error) {
        loading.style.display = 'none';
        errorMessage.style.display = 'block';
        document.getElementById('errorText').textContent = error.message;
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>